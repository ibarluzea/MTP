def lzw_compress(msg):

    dictionary = {}
    output = []
    buffer = ""
# Creant el diccionari per UNICODE (amb ascii es de 256) --> NO ESTAN TOTS ELS CARACTERS, PERO ESQUE HI HAN MES DE 100000.
    for i in range(65536):
      dictionary[chr(i)] = i
    next_code = 65536
    
    for i in msg:
        buffer += i # Miro el seguent caracter i del msg.
        if buffer not in dictionary:  #Afegeixo al diccionari i al output la seq no guardada -->.
            output.append(dictionary[buffer[:-1]])
            dictionary[buffer] = next_code
            next_code += 1
            buffer = i

    output.append(dictionary[buffer]) # String que conforma el output: Llista dels index del diccionari que envio.
    return output

def lzw_decompress(compressed_data):
    
    dictionary = {i: chr(i) for i in range(65536)} # Es pot fer també així i queda més compacte, same que el compressor.
    output = []
    buffer = ""
    next_code = 65536  

    for j in compressed_data:
        if j not in dictionary:
            entry = buffer + buffer[0]  # Si surt això el canal ens fastidia la compressió i no podem descomprimir.
        else:
            entry = dictionary[j]
        output.append(entry)
        if buffer:
            dictionary[next_code] = buffer + entry[0]
            next_code += 1
        buffer = entry

    return ''.join(output)

def main():
    input_text = "The best way to get something done if you if you hold it near and dear to you that you like to be able to... Anyway - Joe Biden Lesgo Brandon ⟴⟴⟴"  
    compressed_data = lzw_compress(input_text)
    print("Compressed Data:", compressed_data)
    
    losses = 0 # Mirar que passa si no s'envien els missatges del final --> No passa re super critic.
    for i in range(losses):
      compressed_data.pop()

    #compressed_data.pop(2) Mirar que passa si es fastidia algo del mig --> Critic.

    print("Compressed Data with Losses:", compressed_data)
    decompressed_text = lzw_decompress(compressed_data)
    print("Original Text:", input_text)
    print("Decompressed Text:", decompressed_text)

if __name__ == "__main__":
    main()
